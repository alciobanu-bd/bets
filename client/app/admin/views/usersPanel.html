
<div ng-controller="AdminUsersPanel">

    <input type="text" class="form-control cornered-input" style="width: 30%; margin-bottom: 1.5em;"
        placeholder="Search user" ng-model="searchedUser" typeahead="user.username for user in users | filter:$viewValue"
        ng-keydown="openUserModalOnEnter($event)">

    <div class="row top-buffer-1-em" style="margin-bottom: 2em; font-size: 1.2em;">
        <span class="col-xs-1">&nbsp;</span>
        <span class="col-xs-2">Username</span>
        <span class="col-xs-3">E-mail</span>
        <span class="col-xs-2">Register date</span>
        <span class="col-xs-2">Place/Points</span>
        <span class="col-xs-1">Rank</span>
        <span class="col-xs-1">Disabled</span>
    </div>

    <div ng-repeat="user in users" class="row top-buffer-0-5-em">
        <span class="col-xs-1">
            <span class="glyphicon glyphicon-cog" ng-click="openModal(user)" style="cursor: pointer;"></span>
        </span>
        <span class="col-xs-2">{{user.username}}</span>
        <span class="col-xs-3">{{user.email}}</span>
        <span class="col-xs-2">{{user.registerDate | date:'MMM d, y'}}</span>
        <span class="col-xs-2">{{user.place}}/{{user.points}}</span>
        <span class="col-xs-1">{{RolesFactory.findRoleByName(user.role).beautifulName}}</span>
        <span class="col-xs-1">{{!!user.disabled ? 'Yes' : 'No'}}</span>
    </div>

</div>


<script type="text/ng-template" id="profileViewModalAdmin.html">
    <div class="modal-header">
        <h3 class="modal-title">{{user.username}}</h3>
    </div>
    <div class="modal-body">
        <div class="row">
            <span class="col-xs-3">
                Username
            </span>
            <span class="col-xs-9">
                {{user.username}}
            </span>
        </div>
        <div class="row">
            <span class="col-xs-3">
                E-mail
            </span>
            <span class="col-xs-9">
                {{user.email}}
            </span>
        </div>
        <div class="row">
            <span class="col-xs-3">
                Place
            </span>
            <span class="col-xs-9">
                {{user.place}}
            </span>
        </div>
        <div class="row">
            <span class="col-xs-3">
                Points
            </span>
            <span class="col-xs-9">
                {{user.points}}
            </span>
        </div>
        <div class="row">
            <span class="col-xs-3">
                Average
            </span>
            <span class="col-xs-9">
                {{user.avgPoints.toFixed(2)}}%
            </span>
        </div>
        <div class="row dropdown"
             ng-if="RolesFactory.userHasRole(userInfo.user.role, RolesFactory.roles.root) &&
             RolesFactory.roleCompare(userInfo.user.role, user.role) > 0">
            <span class="col-xs-3">
                User Rank
            </span>
            <span class="col-xs-9">
                <span class="btn btn-default btn-xs dropdown-toggle" type="button" id="dropdownMenuRole"
                  data-toggle="dropdown" style="cursor: pointer">
                    {{RolesFactory.findRoleByName(user.role).beautifulName}}
                    <span class="caret"></span>
                </span>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuRole" style="cursor: pointer">
                    <li role="presentation" ng-repeat="role in RolesFactory.roles">
                        <a role="menuitem" tabindex="-1" ng-click="user.role = role.name">
                            {{role.beautifulName}}
                        </a>
                    </li>
                </ul>
            </span>
        </div>
        <div class="row" ng-if="!RolesFactory.userHasRole(userInfo.user.role, RolesFactory.roles.root) ||
            RolesFactory.roleCompare(userInfo.user.role, user.role) <= 0">
            <span class="col-xs-3">
                User rank
            </span>
            <span class="col-xs-9">
                {{RolesFactory.findRoleByName(user.role).beautifulName}}
            </span>
        </div>
        <div class="row">
            <span class="col-xs-3">
                Birth date
            </span>
            <span class="col-xs-9">
                {{user.birthDate | date:'MMM d, y'}}
            </span>
        </div>
        <div class="row">
            <span class="col-xs-3">
                Register date
            </span>
            <span class="col-xs-9">
                {{user.registerDate | date:'MMM d, y'}}
            </span>
        </div>
        <div class="row">
            <span class="col-xs-3">
                Registration IP
            </span>
            <span class="col-xs-9">
                {{user.registrationIp}}
            </span>
        </div>
        <div class="row" ng-if="user.lastLogin">
            <span class="col-xs-3">
                Last login
            </span>
            <span class="col-xs-9">
                {{toDate(user.lastLogin) | date: 'EEEE, MMM d, y, h:mm a'}}
            </span>
        </div>
        <div class="row dropdown"  ng-if="RolesFactory.userHasRole(userInfo.user.role, RolesFactory.roles.admin) &&
            RolesFactory.roleCompare(userInfo.user.role, user.role) > 0">
            <span class="col-xs-3">
                Active
            </span>
            <span class="col-xs-9">
                <span class="btn btn-default btn-xs dropdown-toggle" type="button" id="dropdownMenuActive"
                data-toggle="dropdown" style="cursor: pointer">
                    {{!!user.active ? 'Yes' : 'No'}}
                    <span class="caret"></span>
                </span>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuActive" style="cursor: pointer">
                    <li role="presentation"><a role="menuitem" tabindex="-1" ng-click="user.active = true">Yes</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" ng-click="user.active = false">No</a></li>
                </ul>
            </span>
        </div>
        <div class="row" ng-if="!RolesFactory.userHasRole(userInfo.user.role, RolesFactory.roles.admin) ||
        RolesFactory.roleCompare(userInfo.user.role, user.role) <= 0">
            <span class="col-xs-3">
                Active
            </span>
            <span class="col-xs-9">
                {{!!user.active ? 'Yes' : 'No'}}
            </span>
        </div>
        <div class="row dropdown" ng-if="RolesFactory.userHasRole(userInfo.user.role, RolesFactory.roles.admin) &&
        RolesFactory.roleCompare(userInfo.user.role, user.role) > 0">
            <span class="col-xs-3">
                Disabled
            </span>
            <span class="col-xs-9">
                <span class="btn btn-default btn-xs dropdown-toggle" type="button" id="dropdownMenuDisabled"
                data-toggle="dropdown" style="cursor: pointer">
                    {{!!user.disabled ? 'Yes' : 'No'}}
                    <span class="caret"></span>
                </span>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuDisabled" style="cursor: pointer">
                    <li role="presentation"><a role="menuitem" tabindex="-1" ng-click="user.disabled = true">Yes</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" ng-click="user.disabled = false">No</a></li>
                </ul>
            </span>
        </div>
        <div class="row" ng-if="!RolesFactory.userHasRole(userInfo.user.role, RolesFactory.roles.admin) ||
        RolesFactory.roleCompare(userInfo.user.role, user.role) <= 0">
            <span class="col-xs-3">
                Disabled
            </span>
            <span class="col-xs-9">
                {{!!user.disabled ? 'Yes' : 'No'}}
            </span>
        </div>
        <div class="row" ng-if="errorSaving">
            <span class="col-xs-12" style="color: red;">
                An error has occurred. Your options weren't saved.
            </span>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" ng-click="ok()">OK</button>
        <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
    </div>
</script>
